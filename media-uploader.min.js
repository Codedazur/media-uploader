(function(b,m){"function"===typeof define&&define.amd?define(["jquery"],function(f){return b.amdWebGlobal=m(f)}):b.amdWebGlobal=m(b.$)})(this,function(b){return function(m,f){var e=[],g,d,t=null,q=null,x=void 0!==f&&null!==f?f:!1,r=b("<div></div>"),u="file",k={START:"media-uploader:start",PROGRESS:"media-uploader:progress",DONE:"media-uploader:done",FILE_START:"media-uploader:file-start",FILE_DONE:"media-uploader:file-done",FILE_ERROR:"media-uploader:file-error"},v,y,z,A,B,s,C,D,w,n,E,F,l;z=function(a){var c=
{response:void 0};if(window.File&&a instanceof File)c.file=a,c.fileName=a.name,c.name="File";else{if("string"===typeof a)a=0<b(a).length?b(a)[0]:void 0;else if(a instanceof jQuery)a=a[0];else if(!E(a))throw Error("Unexpected type passed. Media-uploader supports, querySelector string or input element.");c.fileName=a.value;c.input=a;c.name=a.name}e.push(c)};A=function(){d=0;l(k.START);s()};s=function(){if(0<e.length&&d<e.length)if(l(k.FILE_START,{name:e[d].name,fileName:e[d].fileName}),y())C(e[d]);
else{if(e[d].file)throw Error("File detected and XHR is not supported!");D(e[d])}else B()};C=function(a){var c=a.file?a.file:a.input.files[0],h=new XMLHttpRequest,g=new FormData,p,f=!1;g.append(a.file?u:a.input.name,c);h.onload=function(a){p=a.target.response;if(!x)try{p=b.parseJSON(p)}catch(c){f=!0}200!==a.target.status||f?f?n("JSON parse error"):n(p):w(p)};h.upload.onprogress=function(a){a.lengthComputable&&l(k.PROGRESS,Math.floor(a.loaded/a.total*100*((d+1)/e.length)))};h.open("POST",m,!0);h.send(g)};
D=function(a){void 0===g&&F();b(document.body).append(g);var c=b('<form method="post" enctype="multipart/form-data" action="'+m+'?iframe=true" target="'+g.getAttribute("id")+'"></form>'),h,d,e=!1;d=b(a.input).parent();b(c).css({position:"absolute",top:"-3000px"}).append(b(a.input));b(document.body).append(c);b(g).one("load",function(c){h=b(g).contents().text();if(!x)try{h=b.parseJSON(h)}catch(f){e=!0}e?n("JSON parse error"):h.error?n(h):w(h);b(g).remove();d&&b(d).append(a.input)});try{c.submit()}catch(f){throw Error("Cannot submit form! ",
f);}};F=function(){var a="image-upload-iframe-"+Math.round(1E5*Math.random());g=b('<iframe width="1" border="1" height="100" id="'+a+'" name="'+a+'"></iframe>')[0];b(g).css({position:"absolute",top:"-3000px"})};w=function(a){e[d].response=a;l(k.FILE_DONE,a);d+=1;s()};n=function(a){e[d].response=a;e[d].error=!0;l(k.FILE_ERROR,a);d+=1;s()};B=function(){l(k.DONE,e)};v=function(){return null!==q?q:navigator.userAgent.match(/(Android (1.0|1.1|1.5|1.6|2.0|2.1))|(Windows Phone (OS 7|8.0))|(XBLWP)|(ZuneWP)|(w(eb)?OSBrowser)|(webOS)|(Kindle\/(1.0|2.0|2.5|3.0))/)?
q=!1:q=!b('<input type="file" name="upload-test" />')[0].disabled};y=function(){return t=null===t?void 0!==window.XMLHttpRequest&&void 0!==window.FormData:t};E=function(a){return"object"===typeof HTMLElement?a instanceof HTMLElement:a&&"object"===typeof a&&null!==a&&1===a.nodeType&&"string"===typeof a.nodeName};l=function(a,c){r.trigger(a,c)};return{Event:k,defaultFileFormName:function(a){a&&(u=a);return u},add:function(a){var c;if(!v())throw Error("Upload is not supported. You can use uploadSupported()");
"[object Array]"!==Object.prototype.toString.call(a)&&(a=[a]);for(c in a)z(a[c])},upload:function(){A()},uploadSupported:function(){v()},on:function(a,c,b){r.on(a,c,b)},one:function(a,c,b){r.one(a,c,b)},off:function(a,b,d){r.off(a,b,d)}}}});
