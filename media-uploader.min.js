(function(b,m){"function"===typeof define&&define.amd?define(["jquery"],function(e){return b.amdWebGlobal=m(e)}):b.amdWebGlobal=m(b.b)})(this,function(b){return function(m,e){var d=[],g,c,t=null,q=null,w=void 0!==e&&null!==e?e:!1,r=b("<div></div>"),h={START:"media-uploader:start",PROGRESS:"media-uploader:progress",DONE:"media-uploader:done",FILE_START:"media-uploader:file-start",FILE_DONE:"media-uploader:file-done",FILE_ERROR:"media-uploader:file-error"},u,x,y,z,A,s,B,C,v,n,D,E,k;y=function(a){if("string"===
typeof a)a=0<b(a).length?b(a)[0]:void 0;else if(a instanceof jQuery)a=a[0];else if(!D(a))throw Error("Unexpected type passed. Media-uploader supports, querySelector string or input element.");d.push({response:void 0,fileName:a.value,input:a,name:a.name})};z=function(){c=0;k(h.START);s()};s=function(){0<d.length&&c<d.length?(k(h.FILE_START,{name:d[c].name,fileName:d[c].fileName}),x()?B(d[c]):C(d[c])):A()};B=function(a){var l=a.input.files[0],f=new XMLHttpRequest,g=new FormData,p,e=!1;g.append(a.input.name,
l);f.onload=function(a){p=a.target.response;if(!w)try{p=b.parseJSON(p)}catch(f){e=!0}200!==a.target.status||e?e?n("JSON parse error"):n(p):v(p)};f.upload.onprogress=function(a){a.lengthComputable&&k(h.PROGRESS,Math.floor(a.loaded/a.total*100*((c+1)/d.length)))};f.open("POST",m,!0);f.send(g)};C=function(a){void 0===g&&E();b(document.body).append(g);var l=b('<form method="post" enctype="multipart/form-data" action="'+m+'?iframe=true" target="'+g.getAttribute("id")+'"></form>'),f,c,d=!1;c=b(a.input).parent();
b(l).css({position:"absolute",top:"-3000px"}).append(b(a.input));b(document.body).append(l);b(g).one("load",function(l){f=b(g).contents().text();if(!w)try{f=b.parseJSON(f)}catch(e){d=!0}d?n("JSON parse error"):f.error?n(f):v(f);b(g).remove();c&&b(c).append(a.input)});try{l.submit()}catch(e){throw Error("Cannot submit form! ",e);}};E=function(){var a="image-upload-iframe-"+Math.round(1E5*Math.random());g=b('<iframe width="1" border="1" height="100" id="'+a+'" name="'+a+'"></iframe>')[0];b(g).css({position:"absolute",
top:"-3000px"})};v=function(a){d[c].response=a;k(h.FILE_DONE,a);c+=1;s()};n=function(a){d[c].response=a;d[c].error=!0;k(h.FILE_ERROR,a);c+=1;s()};A=function(){k(h.DONE,d)};u=function(){return null!==q?q:navigator.userAgent.match(/(Android (1.0|1.1|1.5|1.6|2.0|2.1))|(Windows Phone (OS 7|8.0))|(XBLWP)|(ZuneWP)|(w(eb)?OSBrowser)|(webOS)|(Kindle\/(1.0|2.0|2.5|3.0))/)?q=!1:q=!b('<input type="file" name="upload-test" />')[0].disabled};x=function(){return t=null===t?void 0!==window.XMLHttpRequest&&void 0!==
window.FormData:t};D=function(a){return"object"===typeof HTMLElement?a instanceof HTMLElement:a&&"object"===typeof a&&null!==a&&1===a.nodeType&&"string"===typeof a.nodeName};k=function(a,b){r.trigger(a,b)};return{Event:h,add:function(a){var b;if(!u())throw Error("Upload is not supported. You can use uploadSupported()");"[object Array]"!==Object.prototype.toString.call(a)&&(a=[a]);for(b in a)y(a[b])},upload:function(){z()},uploadSupported:function(){u()},on:function(a,b,c){r.on(a,b,c)},one:function(a,
b,c){r.one(a,b,c)},off:function(a,b,c){r.off(a,b,c)}}}});
